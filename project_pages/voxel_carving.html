<!DOCTYPE html>
<html lang="en">

<head>
    <title>Angela Xing</title>
    <link rel="shortcut icon" type="images/png" href="../images/browser_icon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, inital-scale=1">
    <link rel="stylesheet" href="../stylesheets/navbar_style.css">
    <link rel="stylesheet" href="../stylesheets/proj_page_style.css">
    <link rel="stylesheet" href="../stylesheets/voxel_carving_style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Karla:wght@300&display=swap" rel="stylesheet">
</head>

<body>

    <!-- header -->
    <header>
        <h2>
            <a href="../index.html">ANGELA XING</a>
        </h2>
        <!-- navbar links -->
        <nav>
            <ul class="navbar-link">
                <li>
                    <a class="nav-individual-link" href="../index.html">ABOUT</a>
                </li>
                <li>
                    <a class="nav-individual-link" href="../projects.html">PROJECTS</a>
                </li>
                <li>
                    <a class="nav-individual-link" href="../gymnastics.html">GYMNASTICS</a>
                </li>
                <li>
                    <a class="nav-individual-link" href="../resume.html">RESUME</a>
                </li>
            </ul>
        </nav>
    </header>

    <!-- body -->
    <div class="container">

        <!-- Summary Section -->
        <div id="header-bracket">
            <h1> VOXEL CARVING </h1>
            <h2> June 2022 </h2>
            <h2> Python </h2>
        </div>

        <div class="content">
            <p>
                Voxel Carving is a project I worked on in the beginning of Summer 2022. I decided to try this
                project because I worked on 3D reconstruction for my final project in Computer Vision and
                wanted to expand a bit more. For that final project, my group and I used depth cameras (the Kinect V2
                and the iPhone depth camera) in order to reconstruct ourselves and our professor. To learn a
                bit more on this topic, I decided to try out a different technique which lead me to voxel
                carving.
            </p>
        </div>

        <!-- Data Section -->
        <div class="bracket">
            <h2>
                DATA
            </h2>
        </div>

        <div class="content">
            <p>
                The 'dino' data set contains images of a plaster dinosaur (stegosaurus), and the 'temple'
                data set contains images of a plaster reproduction of the Temple of Dioskouroi. Both data sets
                are taken from the
                <a href="https://vision.middlebury.edu/mview/data/">Vision Department at Middlebury</a>.
                The images were taken using the
                <a href="http://graphics.stanford.edu/projects/gantry/">Stanford Spherical Gantry</a>.
                Each data set contained images as well as .txt file with the camera calibration information
                corresponding to each image. Additionally, the bounding box information for each data set is
                contained within the README for that particular data set.
            </p>
        </div>

        <!-- Implementation Details Section -->
        <div class="bracket">
            <h2>
                IMPLEMENTATION DETAILS
            </h2>
        </div>

        <div class="content">
            <p>
                I started this project by reading about voxel carving and it's process using these resources:
            <p id="resources">
                <a href="https://www.cs.toronto.edu/~kyros/pubs/00.ijcv.carve.pdf">A Theory of Shape Carving</a>
                <a href="http://www.cs.cmu.edu/~seitz/course/Sigg00/slides/seitz-voxel.pdf">
                    From Image to Voxels Lecture Slides
                </a>
                <a href="https://web.stanford.edu/class/cs231a/course_notes/05-active-volumetric-stereo.pdf">
                    Active and Volumetric Stereo Lecture Notes
                </a>
            </p>
            <p>
                After reading about voxel carving and it's process, I decided the
                best way to approach writing the code was to split it into sections - extracting silhouettes,
                calculating projection matrices, generating the initial voxel grid, and carving.
            </p>
            </p>

            <h3> Silhouettes </h3>
            <p>
                I started by extracting silhouettes. In order to do this, I first converted the image to
                gray scale, then blur the image, and finally extracted the silhouette. Each silhouette is
                represented as an array, and the silhouettes of all images are stored in a numpy array.
            </p>

            <h3> Projection Matrices </h3>
            <p>
                Next, I calculated the projection matrices. Each camera's calibration information is provided
                in .txt file. A camera's projection matrix is calculated by multiplying the camera's
                intrinsic matrix with the camera's extrinsic matrix. I stored all the projection matrices in a
                numpy array where each projection matrix corresponds to each silhouette in the array of silhouettes.
                The projection matrix is as follows:
            </p>
            <div class="row" id="projection-matrix">
                <table class="matrix">
                    <tr>
                        <td>f<sub>x</sub></td>
                        <td>s</td>
                        <td>x<sub>0</sub></td>
                    </tr>
                    <tr>
                        <td>0</td>
                        <td>f<sub>y</sub></td>
                        <td>y<sub>0</sub></td>
                    </tr>
                    <tr>
                        <td>0</td>
                        <td>0</td>
                        <td>1</td>
                    </tr>
                </table>
                <table class="matrix">
                    <tr>
                        <td>r<sub>1, 1</sub></td>
                        <td>r<sub>1, 2</sub></td>
                        <td>r<sub>1, 3</sub></td>
                        <td>t<sub>1</sub></td>
                    </tr>
                    <tr>
                        <td>r<sub>2, 1</sub></td>
                        <td>r<sub>2, 2</sub></td>
                        <td>r<sub>2, 3</sub></td>
                        <td>t<sub>2</sub></td>
                    </tr>
                    <tr>
                        <td>r<sub>3, 1</sub></td>
                        <td>r<sub>3, 2</sub></td>
                        <td>r<sub>3, 3</sub></td>
                        <td>t<sub>3</sub></td>
                    </tr>
                </table>
            </div>

            <h3> Initial Voxel Grid </h3>
            <p>
                Once I calculated the projection matrices, I then created and displayed the inital grid
                (based on the given bounding box information). I calculated the size of a voxel based on the
                approximate desired number of voxels and the bounding box information. To find the size of each
                voxel, I divided the volume of the bounding box by the approximate number of voxels to find
                the volume of each voxel. The size of the voxel is the cube root of the volume of a single
                voxel. From here, I calculated the coordinate point of each voxel and store it in a numpy array.
            </p>

            <div class="figures">
                <div class="single-figure">
                    <img src="../images/voxel_page/dino_grid.jpg" alt="dino grid">
                    <p class="caption">Voxel Grid For Dino</p>
                </div>
                <div class="single-figure">
                    <img src="../images/voxel_page/temple_grid.jpg" alt="temple grid">
                    <p class="caption">Voxel Grid For Temple</p>
                </div>
            </div>

            <h3> Carving </h3>
            <p>
                In terms of the general carving process, for each voxel, I calculated the corresponding image
                coordinate. If the pixel lies in the silhouette, it's included in the final reconstruction,
                otherwise it's excluded. More specifically, for each voxel coordinate, I calculated the
                homogenous image coordinate for all images by multiplying the corresponding projection matrix
                with the homogenous voxel coordinate. Rather than using a for loop to iterate through each voxel,
                I performed these calculations using numpy arrays to improve speed. From here, I calculated the
                cartesian
                image coordinate by
                dividing the u and v coordinates by the w coordinate. Then, I removed any x coordinates greater
                than the width of the image and y coordinates greater than the height of the image. If
                the value at that particular image coordinate lies in the silhouette it gets counted, and if
                the count is greater than a threshold, then the voxel gets included in the final
                reconstruction. The threshold is currently set at 80% of the total number of images in the
                data set (I determined this from trial and error). I stored the final voxels in a numpy array and
                displayed the final reconstruction using Open3D.
            </p>
        </div>

        <!-- Results Section -->
        <div class="bracket">
            <h2>
                RESULTS
            </h2>
        </div>

        <div class="content">
            <div class="figures">
                <div class="single-figure">
                    <img src="../images/voxel_page/dino1.jpg">
                </div>
                <div class="single-figure">
                    <img src="../images/voxel_page/dino2.jpg">
                    <p class="caption">
                        Dino Reconstruction
                    </p>
                </div>
                <div class="single-figure">
                    <img src="../images/voxel_page/dino3.jpg">
                </div>
            </div>

            <div class="row-figure">
                <div class="figures">
                    <div class="single-figure">
                        <img src="../images/voxel_page/temple1.jpg">
                    </div>
                    <div class="single-figure">
                        <img src="../images/voxel_page/temple2.jpg">
                        <p class="caption">
                            Temple Reconstruction
                        </p>
                    </div>
                    <div class="single-figure">
                        <img src="../images/voxel_page/temple3.jpg">
                    </div>
                </div>
            </div>
        </div>

    </div>

</body>